package wlei.candy.rsa;

import org.apache.commons.io.FileUtils;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import wlei.candy.share.util.FilePathUtil;

import java.io.File;
import java.io.IOException;

import static org.junit.jupiter.api.Assertions.assertEquals;

/**
 * 对封装java加密的测试
 *
 * @author HeLei
 */
class JdkCipherTest {

  @Test
  void AESEncrypt() throws ParamCodingException {
    String encodedAESKey = JdkCipher.getEncodedAESKey();
    String c = JdkCipher.AESEncrypt(PlainText.PrefaceToTengwangPavillion, encodedAESKey);
    String d = JdkCipher.AESDecrypt(c, encodedAESKey);
    assertEquals(PlainText.PrefaceToTengwangPavillion, d);
  }

  @Test
  void RSAEncrypt() throws ParamCodingException {
    String[] keyPair = JdkCipher.getEncodedRSAKeyPair(512);
    String c = JdkCipher.RSAEncrypt(PlainText.PrefaceToTengwangPavillion, keyPair[0]);
    String d = JdkCipher.RSADecrypt(c, keyPair[1]);
    assertEquals(PlainText.PrefaceToTengwangPavillion, d);
  }

  @Test
  void testDecrypt() throws ParamCodingException {
    String c = "kleP857zwoqMC5IlkK0ec66+M1tQoaNmEVWj0SvnD+QOrIh9fcJsqXJS8VqfyOEzHSo421qiRly06BkoHvVWZA==,"
        + "PSVqum3wYiCHhWx1QDw0k4/GrFX3e6SbDGat8gbaYlsV/snIhms39bWYYoU5y5UAq4RBHhyCuTDPtetukW4NHw==,"
        +
        "MzUxNTUwNDIxNTUwMTA0ODE5OTczODgxOTE5NzM3MzA3ODI4ODk5NzM0OTI2MDg3MDMxNjgwMjU4Njg5ODU4NDY3MTYyODEwNzU3NzczMDM5ODA3MzIwMzc5NzEwOTIwMTI1MTY2MDY3Njc5ODM5NDc1MDk1OTk3MTMwMTMzOTgxMjI1MTEzNTkwMjU3ODY3NTc3MTg0NDcyMTg0OTAxMjIzMzYyNjk1ODk1MjczMzU0ODY4MjI5MjEyMDM2MjEwMTA4NDAwNjkxNzE0NzcwMzY4NDIwMzAwODgzNDkxODMxMjUwNzIyNDAyNTQwOTkzODgwNzQ3NDI4NTg2MjM1MjA0MTMxOTU5NzgyODE4NzMxNjA0NDg4NjYyMjEyNjQ5NTc3ODEyNTcwMjMzMTQzMjk3NjcwNzI5MzIwMjg0MDA4MjczNzcwMDA0NTU5NDAwOTY5OTEzNzI3NzI3OTQzNjQyMjc0ODc0MzQ1NDg0ODc4MTYwODU2MjIwNzU5NTg2NzE4MzU0MDAxNDgwMjAzODEyOTMxMzg4NjExOTQzNzk2ODYzNzE3MDMxNDMwMjA2MjgwNTQ2MzU1NjY2NjQwMjI3MjEzMDc1NjExNDcwMDEwNDk3NjUwNTU4ODA5NzY3NjE4MTYwNjQ2NDgxMDg3NjI2NzQwOTMwMzAxNTkxNDYzNDM5NTk5NTE2OTg5NTMwMzI5NjExMjg1NTcyNjg2NTgwODg5MTYyMzczOTkxMTE4NDY4ODMxOTM1NDc0MjcwMDMxMDI0Njk5OTY2NDAzODA4MTk5MjM1MDY2MjU5ODA3NTE5NjIyMjU1NzEwNzkyODIwMzY2ODUwOTYwOTU0NDI5MzQyMjcyODk4MzU0ODcwNDg0NjEzNDk1MzY4MDI1OTQxNDQ5NTE1NTczMDM1Mjg3NzQwMDIxODcyMjE4NTMyNDkzMzU5NTE3NzEyOTAyMDIxODU1MjAxNTU5MzE2MzQzNTkxNzM5NDA4MzQ4MjgxMDgzMTk2MjYxMTUxNzI3MzUxNTI4OTAzNDI5MjExNTc2MDEwMjA3NzU2OTE4MDczOTEyNTQ3NTExMDYwMjQyNTA1MzgzMDE5MTYwNDgxNzg5MzI5MTM4MTM2MzcyNDYwNjk0NDQ1MDk2NzczMTA5MTk5NTQ1ODEyMzQ1Nzc2ODgwNjc4MzM0NTU5MjY0Njc5MjgzNzg5ODcxMDg1NDYwNTcyNDM5MzYzOTU4NTY2MzA3MTUzNTM0OTkzMDk2ODIyMTA3MjU4MDE0NDE5MzcwMDI1Njg2NDI3MzcwMDg0Nzc3MTI4MDg2MDQ4MTMxOTYxNTY4NDM0NzA4NjY3OTI0OTU2MzgwMDQxMDM2MjAwNzc1OTI1Njg0ODA3NDkzNTQxMDA0NzA2NTExMTU0Njc3MTMxNTI2NjE4Mzc5NDkwMjg5MTQ5NDQxMjUxMDI2NzcyMDg0ODEzNjkyMzY5OTE2MDE0MTIwOTc0NDkzMjQ5MjUyMDM2MDA2MDI1MzgwMDEyMzY0Njk3NDQ4MTYxNTAyNjg5ODI3MjI2NTU1MzM2OTI2MDM1NDY0ODE1NzEwMzI2MTg3MjMwMjcyMzUzODI2NjM3NTkxNjMyNTU2MzQ5MDcwMDk2ODE4ODg1ODk3NzY0Mzg5MDk2NzUzMzA5NTQ3MjMyNzg3OTAxNDAyMjMwNDg3NDY2MTU1NDQ2MDkyNzkyMjY5ODgxOTU0NDAyODcxMjcxMTY0NDU5Mjc4MTA1ODM0Mzc4NTc2NTg3ODg4MjM5MzEzOTM2Nzc2MDMyNTY1OTY1NDU2OTkzNTY1NTYzMDMwMjM1MTYzOTExODE3NTU2MzE1MTAzNzY1OTc5MjQzODI5MzM3MzAzMDY0ODg0MDYyMjQ3NDgxMTc3NTE1MjUyODgyNTc2NzYwNDc0MjU4NzMwMTAzMzUwNzM3NDQ1MzI4NzA3ODk1OTAzNzgwNDc5MzE4OTI0MTQ3MDI1NDY5MTMwMjM1MjMwNjk0MTA1ODI2NDQ4MTI3Nzg5NjA0MDk0NTY3MTUxMTIwODcwNDU5MjM1MTU1MTQ0NzQ0NzE5NDM0NjU3NjU5MjQzMTc5OTg2MTEyMTc4NzA1NDU0NTQ5Mzk3MjkyMjI2NjA4MDY1MjkwNDU5MTUzMzY5MDEwNTEzODI5NjA5NzA2MTgzNzMxMDk2NjExMDAyNzM4MDI5OTYyNjE2MjU1MzI2MjI0Mzc3NzQ5MDA4NTA3Mzc4NTkzOTg1NDI3MTg3MzkxOTY3NjQ3MTkxMzUxMTgyMTg5NDI3MTI4MTI2OTUxOTM3MDcwMDA3MTM4Njc5MDA3MzU2OTg3NjY0MDg4ODM1MzIwMjg4MDk1MDA3NDk4NTA4NDM1NzYzNjU4MTk5ODc2NzA2ODI2NDM2NTAwODAyOTMxMjQ2MDc5NzEzMjA4MDk4OTQ2MjkwNzAxNDUyMTE5ODc3MzUwMzkwMTMyNDUzNjcyNDQ5NDE1OTk0MzkwMTc2NTc3ODk2NDI5MDM0NDA0MjQwMTQzNzc1NjQ5NzM0Mjc0OTc4Njk4MDQzNjQzMTAzMDEyNzc2NjEzMDkwNzE0MzI1MjI2ODc0NTg4MTI1MTAzMTIyMzgzOTkxNTQ4OTM2OTQyNTU3MzQwOTU2ODM4ODc2MzQ3MDg4MzIzMjIzNDc1MTMyODQ5NDQ2Mjg2ODg5MTQzNTcyODU3NTExMTU2MzY4MzEzMzMxNDk5NDk0NjM1OTEzMDM2Mzk1OTMwNzc0NjQ5MTc5ODMwNzY5NTkwMzI1MTI4NTQ2MjE4MDc5Njk5NTk1MTU0NDI4MzMwNzk3MDU2NzY4MjYwMDE0NjM0MDgwMDgwNjI4NTc2NjM0ODk4MDU3MzYxMjQzMjk5ODg3NDE3MDc5MDA1NjA1MjAyODgwOTI4NjY4NjYzMDY4NjI3MzA2OTE2NzYyODEwODQwMDExNTYzNzYzMDMxMTQ3NzMzMzc3NzI3NTUwMjc1MzkyNDI0NzU5NzYxNjgxODY1MDY3NzI1MDg0MzAwNjgyMjUxOTAxNjIzNDM2MjUzMjQ2MTc5Nzc4MTQyODAzODExNTM1NzEwNzAzNTU4MDQxMTYwNzc5NTI0NjkwMTE4NTIzMjU5MzcyMTAyNzI1NDIyNDY1OTY0OTUxNzgxNzg2NzM2NTg4NzczMjQyODUwMTAwNDc0MzYwNTg3NjM5MDU1NDkyODkyOTA2MTc4NjAyNDE0NjU1MTUyMzcyODQxMDIyODM1NTk2NDU0MTAzMjMyODI0MzQ5NzgzMTMwNTM3OTM0MzM0OTkwOTkyMzIyMDExOTAxMDkwNzk3MjMzNDM1OTYyMzkyOTgyNzg0ODk2NTgxOTY3MTE5MzY4MTM1NDA0MTY5OTU0MDQzNjQ2OTg4NjI0MDg1OTgzMTA5ODc5Njk2MTk2ODg2ODc5MzczMzY0MTgxOTg2NTkxMjAxNjg3NDE2MzE1Mzc5Mjc0MzQ2MzM1NzEwNTcyNjIzMjQzMTMzNDkwNjkyOTU3NjAwMTUyMDcwMzQ3MzY2NjY1MjI2NjY4NjYzOTI2OTczNjQzNTg4NzM5Mzg4OTcwNDI3NzkwODUxMTc0NDcxNjc5ODE1NjE1OTA3MDcwMzg1ODg3OTAyNzU0OTUwMTczNTIyNTUzMzkxNzI2ODIxNDEyODkwNjk2NTgwMjgwNTE0MDcyNTg3NjI3MjkyMjk0Njg1Nzk3OTUxNDYxMDcyNDA2MTkxNDYwMjI4NzU4NjYxODUwNDc4MDM5NzU5NDM4MzcyODg2MDY1MTUxMjEzNTA0NTAxODI4MDgyNzI4MjgxNjk4MDEwNTEzMzU1OTY0OTQ3ODgxMDA5MDU4NTkzMTAwMDU2MzYxOTkxMjcyOTgzMDAzMzQ2NTg1MzA5ODQ0NTIwOTcxOTk1NzY4NjY1NDA2MTA3NTY2NzcxNTk5MjQwMTkyOTMwNzg2ODc2NjE2MTIyNzg1MTA1MTc3ODU2NDU0NDc5MzIzMzU5NTY0MDE5NDE3NzcwMzQzOTc2MjA0Mzk0NzIxNjEzNzU1MTQ4OTcyNDY4OTMwOTU4ODAxODAxMDU0OTYyNTAxMjkwNzU4NjE5MDU0ODA3NTA4MjY4NzE1MjgxOTc3OTYxNDg1NzE3MjM2NzMyNzY4Nzg3OTk2ODAwMzA5NTY4MjY5Njg2NzYwNjQwMDczNzQ0ODgwNTI4Mjk4NjY3NDcyMjk1NTA0MzQ5Mzk0NjMyNjU0OTYyNTEyODcwNzk2MDk4NjkzNTg5ODY1ODkzNTM4MDQzNjIwMzUxMzM3MjE2NDcwMDUzMTUxMTU4ODIwNzMxNDAwNTU4NTM1MDk4MDkwOTcyMjYyODUzMTkwNDA0MjU5MDQ0NDgwNjA3MTQ1NTU5NTYzMzU0MjM4OTg3NDg3MDEzMzQxNjA5NzMzMjY3NjA2OTYzODgxOTg4NTk0OTQyMDQwNzQwNDIzNDcwNDMzNDM1OTIzNDEwNDc0OTI4MTI3MDk0Njg2MDQ5Mjg5ODQ0NTA1MjcyMjI2NzkwOTU0Njc3NjIzOTUwODQ5Njk4ODMwNjUwMDU5NDk4MDgxODYyMjk2MTkyNDcwNzI2OTMyMDY1ODkzOTkyNjE0Nzg1MDgzNjUzNzAzNTA5MDc1NTU0NzUwMTUyOTgzMjMxMDYzNjA1MzkzNTAyMDIwNTQzMDcyNTM3ODI4MTkwNjgxODM3NjA0OTU2NDMwODM2ODIxMTk0NTgxMjM5NzQ3NTYwMTY4OTMyNDA4MTk1NjY2NjM1MTEzODE3ODk0NTIxOTkxMjg4MDExODA1NzIzNDgxMjUwMTY4Mjk4NTQ1MDY2NTc2MTk5MDg2NjMzMDQ5ODI4MDQ3OTk4ODkxOTMzMjQ0NTY5NDI3NzEzMDM5OTQyNTExMTMwODExOTE3ODc2MjQzOTM0MDAzOTg3NzUwNzU1MjU3NTM5NDMyNjUwMDUxNjU4NjIwNzA3MTIxNjg5NDA2MDYzMDcwNjczNTA1ODIwMjg4OTYxODY5NTIwNTY0MTc1NzkxMzkxNTM3MzEwOTcyNzM5NTYwNzEwNjA4MDcxNzkwODIwODE2MDgxOTY4MTk0NDU5MTAwMjAyNTM4NDU1MTA1MDMzMDU1OTEwMjg5OTg4MzQ1OTQyNDAzOTA4OTkwMDY0NDA3ODU4ODM2MDE3ODY0NTYyNjIyMjQwODQyNDQ2OTI3MDg5Nzc5MTU0MTQyMjQxNDAyNDk3OTgxNjI1ODA2MzcyMjM3NDc0NzgzMjI2MzM2NzEwMTAxNTk3NDU0NzE3MDgwODU3OTY0NTc5NjExMzczNzk0MzAxNjU4MDMyNzM4MjUwNjQyNjczNTEzNTc1Mjg5Njc5NDEyNzc3MDcwNjY5MTg5OTE0MDYwMzc2ODMyNTQyNTEzMjg3NjA3NzYxMjg0NDkyMDI1Nzk1MTAzODE2NjQxNDYxMjc0NTMyODE5MTgwMTAyNjE3MzkzNDE1OTkzODM1NDQzMDMyOTIwMDk0NjgwNzM2NjI2NTM3MzM5ODY4MzI2MzMyOTExMjE3MTQ5OTcwMzYzMDI5NzIyOTI3MjIwODAyMjAzODczNDQyNjc0MjI0MTE2NzQ2MjE2NjU4NDQyODU3Njg4ODcyMzQxNjY4MzMyNTcxMDM1NjI2MTM5MDMzMTYxODA2MDEwMDk1MzEyMDk3NTQ5OTQxOTIyMTgxOTE4NTMxODgxNzQ4MjQ2NDMxNjQzNTM1NjQ5MDA5MjU1ODg4MjYzODM2MDcyOTg0NzMyNjc5MjMyNzMwMjQ0NjcxMzkzNTc4MjM2NTEyOTc3OTA2MTUzODI5ODc2MzkyMzAzMTk1MjIxNDgwNDA4MTEwMzI0ODA4MTEzMzQyMzMyMTAxMDg3OTg1NzA5NzMyOTc3MDA1Njk3NjkzMDA4ODA4NTU1MTYwNjcwMDIzOTA0OTQxNjQ0MDU3MjEwMjY3NTU4MDA3MzU2OTM5MDc2NDc0OTg0MTkwODU0NzkzODY1MDUwMDM1NDcwMjA2NDQ4MTQ5MTYzNTYzODIyNTM2OTcwOTI0Nzc4OTE0MTU1MDAxNDAwNzg1NTEwNjc1NTE1MzgwODA3OTAxMjcyODAwOTk5NDQ5MDQwNjEyMTQ0Nzg4NTIyMDU4Njk2ODMwMTk3NTE2MzI2OTc1NTQ4ODkxMzEwMzAyMDQ2NjkxOTIzMTM4ODU2MTQ1Nzk5ODEyNjAwNTYwMDA3NTM4MDQxODg1MDQ3Nzg1MTIxNDIyNDczNDY5NTc4MjAyMjcxMTEwMTA0MDg1MzUzNTA2ODczMDEzNjE5MjM4MjE1MDQ5MjE1MzQwNTU5NjY3NDA1NjU0NjA2MTEzMzQ1MzA4NzY3MzYyMTk0ODE0MDQ0Mzg5ODg5Mjc5OTE2NDMwMDEyNzU0MDEyODYwMTM0NzgxNzY2NDI3NDA5Nzg0NjI0Mjk4MTE1Nzg4NDQyMDczMjg0NTQ2NTE1MjQ3NjcwNzYwMDk3NzkyNzU2ODg1OTEzNTcxOTM3NDY2MTg5MzQ5NjY1NTE2NjYwNjU4OTY1OTgwNTE1MTg2NzI0ODgxMTQ0NTU2MDUyMjc3NjE3MjUyNDY4MzM4MTUzNTk2ODI4OTQyMzg1MDU4NjUzNDM3OTM4NjAyODMyODQyNTkxMjc2NzAyMjk4NTk2NzI2NjI5Mjk2NjEwMDYzMDAzNzc4MDYzMjQxNDEzMjEwODIwNjM2OTcxNzMzMTA3MjcwNTYzMDg0NzI3MTU2MDU2MTA2NTEwNTk4ODk3MDI5NDcwNzMwMjIwMTAyNzI3MjY3MjkxNjI3NjcyMDg1NTcwMjI2ODc5NzYyMTUzODE0MDgzNzI4MjIzNzM1OTc1ODA2NjgxMjkyNDE4Mjk2MzQwOTE1NTU5NTA3MjAzMDIwNzkxOTE0ODQyNzY2MjQxMTY1MDQ2MDU3ODA1OTM5MDUxMTE5NTkxMDE3MjA1NDAzMjg1MzUwMTA4NzA1MTA2MzQ5NzA2OTE5NzI5Njg4NzIzOTg4MDMxMDU0NjMxODcwMDcyMjU3ODI5MDkwOTU0NDU2NjUyNDcwMTk3OTg2NTY4ODQwMjkxNTk4MzIzODI4ODc4Mzg5MTI2ODQ3NTAwMzc4MzY0NjM5NDU5OTIwNTYwNDY2OTcxMzk1MjQ5MDgzODcxOTI4Njc1NTMxNjYwODYwNzY2NDkxNjQ1OTU5ODE1MTc0NDk5NTcwMzUyMDE4ODA0Njk5MDg5MDIyNzI2MTA1Mzk1MjA4MTI0NDA0MDIzMjY3Mjg4NTgzMTA4Mjg5MDgwNTk5MTA5NTA5MTg2NjEzMzQ2NTIyNzM5MTMzODkxMjM4MzAwMTUwMjQxNjExMDc1NjEzNTc3MDEwMjIxODcwMTg4MzIxNDU5NTQ4OTYzMzA2MjAwMTU2NTk2MzI1MTM0OTk3NjkzNTk3NTExOTE4MDEwMTg3ODI3NjU1Mzk2NjAz";
    String priKey = "MIIBVQIBADANBgkqhkiG9w0BAQEFAASCAT8wggE7AgEAAkEAq1YJNUSi8BYI0EmrZ84MHce9y3THdslt8cMUIBxBpcEYzuY8Nse96hl4hrESunhW9BaDJTiSD"
        + "/lKhICigHlw3wIDAQABAkEAlfgUzz9or2VaCZayJYZBLL/s7O0mul7NkVQDhae1"
        + "/nJ1mMj5tFa0PZHyMoA3cV7K69BTJA3UFbJf9CU3rtDtwQIhAPtU9ebiWFsa7GPbUZj9CYbRzI2+M0kfTmwjv0n4l5BJAiEAroS1kyjXYgE4ZjXeEMmPvyVl"
        + "+KreHpBsFGIyKhUiR+cCIFVW4uxT3OaKfMvnU4ycFtkFceyLMcTZcXp8pN5MH8KpAiAlnQq5fer1/4dVWDTVb2vg6cGRl9opwjzZI9TmBwoNbwIhAK/p"
        + "+2V1gs3FXJhF83MjBnGmrAf25q+3Kt9NcMTt1nMs";
    String s = JdkCipher.RSADecrypt(c, priKey);
    assertEquals(PlainText.PrefaceToTengwangPavillion, s);
  }

  @Test
  void mixEncrypt() throws ParamCodingException {
    String[] keyPair = JdkCipher.getEncodedRSAKeyPair(512);
    String c = JdkCipher.mixEncrypt(PlainText.PrefaceToTengwangPavillion, keyPair[0]);
    String d = JdkCipher.mixDecrypt(c, keyPair[1]);
    assertEquals(PlainText.PrefaceToTengwangPavillion, d);
  }

  @Test
  void testFile() throws ParamCodingException, IOException {
    String[] keyPair = JdkCipher.getEncodedRSAKeyPair(1024);
    String tmp = System.getProperty("java.io.tmpdir");
    File in = null, out = null;
    try {
      in = FilePathUtil.getAndCreateFile((FilePathUtil.join(tmp, "rsa_in.txt")));
      FileUtils.write(in, PlainText.PrefaceToTengwangPavillion, "UTF-8");
      out = FilePathUtil.getAndCreateFile(FilePathUtil.join(tmp, "rsa_out.txt"));
      JdkCipher.mixEncrypt(in, out, keyPair[0]);
      JdkCipher.mixDecrypt(out, in, keyPair[1]);
      Assertions.assertEquals(PlainText.PrefaceToTengwangPavillion, FileUtils.readFileToString(in, "UTF-8"));
    } finally {
      if (in != null) {
        FileUtils.deleteQuietly(in);
      }
      if (out != null) {
        FileUtils.deleteQuietly(out);
      }
    }
  }

  @Test
  void testStringToNumberSequence() throws ParamCodingException {
    String s = CharEncoding.stringToNumberSequence(PlainText.PrefaceToTengwangPavillion);
    s = CharEncoding.numberSequenceToString(s);
    assertEquals(PlainText.PrefaceToTengwangPavillion, s);
  }
}
